<h1 style="background-color: #fcfcfc; box-sizing: border-box; color: #404040; font-family: &quot;Roboto Slab&quot;, ff-tisa-web-pro, Georgia, Arial, sans-serif; font-size: 28px; margin-top: 0px;">
20. Python C extensions<a class="headerlink" href="http://book.pythontips.com/en/latest/python_c_extension.html#python-c-extensions" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; color: #9b59b6; display: inline-block; font-family: inherit; font-size: 14px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: normal; line-height: 1; text-decoration-line: none; text-rendering: auto; visibility: hidden;" title="Permalink to this headline"></a></h1>
<div style="background-color: #fcfcfc; box-sizing: border-box; color: #404040; font-family: Lato, proxima-nova, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
An interesting feature offered to developers by the CPython implementation is the ease of interfacing C code to Python.</div>
<div style="background-color: #fcfcfc; box-sizing: border-box; color: #404040; font-family: Lato, proxima-nova, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
There are three key methods developers use to call C functions from their python code -&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">ctypes</span></code>,&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">SWIG</span></code>&nbsp;and&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">Python/C</span>&nbsp;<span class="pre" style="box-sizing: border-box;">API</span></code>. Each method comes with it’s own merits and demerits.</div>
<div style="background-color: #fcfcfc; box-sizing: border-box; color: #404040; font-family: Lato, proxima-nova, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
Firstly, why would you want to interface C with Python?</div>
<div style="background-color: #fcfcfc; box-sizing: border-box; color: #404040; font-family: Lato, proxima-nova, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
A few common reasons are :</div>
<ul class="simple" style="background-color: #fcfcfc; box-sizing: border-box; color: #404040; font-family: Lato, proxima-nova, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-size: 16px; line-height: 24px; list-style-image: initial; list-style-position: initial; margin: 0px 0px 24px; padding: 0px;">
<li style="box-sizing: border-box; list-style: disc; margin-left: 24px;">You want speed and you know C is about 50x faster than Python.</li>
<li style="box-sizing: border-box; list-style: disc; margin-left: 24px;">Certain legacy C libraries work just as well as you want them to, so you don’t want to rewrite them in python.</li>
<li style="box-sizing: border-box; list-style: disc; margin-left: 24px;">Certain low level resource access - from memory to file interfaces.</li>
<li style="box-sizing: border-box; list-style: disc; margin-left: 24px;">Just because you want to.</li>
</ul>
<div class="section" id="ctypes" style="background-color: #fcfcfc; box-sizing: border-box; color: #404040; font-family: Lato, proxima-nova, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-size: 16px;">
<h2 style="box-sizing: border-box; font-family: &quot;Roboto Slab&quot;, ff-tisa-web-pro, Georgia, Arial, sans-serif; font-size: 24px; margin-top: 0px;">
20.1. CTypes</h2>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
The Python&nbsp;<a class="reference external" href="https://docs.python.org/2/library/ctypes.html" style="box-sizing: border-box; color: #9b59b6; text-decoration-line: none;">ctypes module</a>&nbsp;is probably the easiest way to call C functions from Python. The ctypes module provides C compatible data types and functions to load DLLs so that calls can be made to C shared libraries without having to modify them. The fact that the C side needn’t be touched adds to the simplicity of this method.</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
<strong style="box-sizing: border-box;">Example</strong></div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
Simple C code to add two numbers, save it as&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">add.c</span></code></div>
<div class="code c highlight-default" style="box-sizing: border-box; color: #999988; font-style: italic;">
<div class="highlight" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; margin: 1px 0px 24px; overflow-x: auto; padding: 0px;">
<pre style="box-sizing: border-box; color: #404040; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; line-height: normal; overflow: auto; padding: 12px;"><span style="box-sizing: border-box;"></span><span class="o" style="box-sizing: border-box; font-weight: bold;">//</span><span class="n" style="box-sizing: border-box; color: #333333;">sample</span> <span class="n" style="box-sizing: border-box; color: #333333;">C</span> <span class="n" style="box-sizing: border-box; color: #333333;">file</span> <span class="n" style="box-sizing: border-box; color: #333333;">to</span> <span class="n" style="box-sizing: border-box; color: #333333;">add</span> <span class="mi" style="box-sizing: border-box; color: #009999;">2</span> <span class="n" style="box-sizing: border-box; color: #333333;">numbers</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">-</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="ow" style="box-sizing: border-box; font-weight: bold;">and</span> <span class="n" style="box-sizing: border-box; color: #333333;">floats</span>

<span class="c1" style="box-sizing: border-box; color: #999988;">#include &lt;stdio.h&gt;</span>

<span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">add_int</span><span class="p" style="box-sizing: border-box;">(</span><span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span><span class="p" style="box-sizing: border-box;">,</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span><span class="p" style="box-sizing: border-box;">);</span>
<span class="nb" style="box-sizing: border-box; color: #0086b3;">float</span> <span class="n" style="box-sizing: border-box; color: #333333;">add_float</span><span class="p" style="box-sizing: border-box;">(</span><span class="nb" style="box-sizing: border-box; color: #0086b3;">float</span><span class="p" style="box-sizing: border-box;">,</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">float</span><span class="p" style="box-sizing: border-box;">);</span>

<span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">add_int</span><span class="p" style="box-sizing: border-box;">(</span><span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">num1</span><span class="p" style="box-sizing: border-box;">,</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">num2</span><span class="p" style="box-sizing: border-box;">){</span>
    <span class="k" style="box-sizing: border-box; font-weight: bold;">return</span> <span class="n" style="box-sizing: border-box; color: #333333;">num1</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">+</span> <span class="n" style="box-sizing: border-box; color: #333333;">num2</span><span class="p" style="box-sizing: border-box;">;</span>
<span class="p" style="box-sizing: border-box;">}</span>

<span class="nb" style="box-sizing: border-box; color: #0086b3;">float</span> <span class="n" style="box-sizing: border-box; color: #333333;">add_float</span><span class="p" style="box-sizing: border-box;">(</span><span class="nb" style="box-sizing: border-box; color: #0086b3;">float</span> <span class="n" style="box-sizing: border-box; color: #333333;">num1</span><span class="p" style="box-sizing: border-box;">,</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">float</span> <span class="n" style="box-sizing: border-box; color: #333333;">num2</span><span class="p" style="box-sizing: border-box;">){</span>
    <span class="k" style="box-sizing: border-box; font-weight: bold;">return</span> <span class="n" style="box-sizing: border-box; color: #333333;">num1</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">+</span> <span class="n" style="box-sizing: border-box; color: #333333;">num2</span><span class="p" style="box-sizing: border-box;">;</span>
<span class="p" style="box-sizing: border-box;">}</span>
</pre>
</div>
</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
Next compile the C file to a&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">.so</span></code>&nbsp;file (DLL in windows) This will generate an adder.so file.</div>
<div class="code bash highlight-default" style="box-sizing: border-box;">
<div class="highlight" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; margin: 1px 0px 24px; overflow-x: auto; padding: 0px;">
<pre style="box-sizing: border-box; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; line-height: normal; overflow: auto; padding: 12px;"><span style="box-sizing: border-box;"></span>#For Linux
$  gcc -shared -Wl,-soname,adder -o adder.so -fPIC add.c

#For Mac
$ gcc -shared -Wl,-install_name,adder.so -o adder.so -fPIC add.c
</pre>
</div>
</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
Now in your python code -</div>
<div class="code python highlight-default" style="box-sizing: border-box;">
<div class="highlight" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; margin: 1px 0px 24px; overflow-x: auto; padding: 0px;">
<pre style="box-sizing: border-box; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; line-height: normal; overflow: auto; padding: 12px;"><span style="box-sizing: border-box;"></span><span class="kn" style="box-sizing: border-box; font-weight: bold;">from</span> <span class="nn" style="box-sizing: border-box; color: #555555;">ctypes</span> <span class="k" style="box-sizing: border-box; font-weight: bold;">import</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">*</span>

<span class="c1" style="box-sizing: border-box; color: #999988; font-style: italic;">#load the shared object file</span>
<span class="n" style="box-sizing: border-box; color: #333333;">adder</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box; color: #333333;">CDLL</span><span class="p" style="box-sizing: border-box;">(</span><span class="s1" style="box-sizing: border-box; color: #dd1144;">'./adder.so'</span><span class="p" style="box-sizing: border-box;">)</span>

<span class="c1" style="box-sizing: border-box; color: #999988; font-style: italic;">#Find sum of integers</span>
<span class="n" style="box-sizing: border-box; color: #333333;">res_int</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box; color: #333333;">adder</span><span class="o" style="box-sizing: border-box; font-weight: bold;">.</span><span class="n" style="box-sizing: border-box; color: #333333;">add_int</span><span class="p" style="box-sizing: border-box;">(</span><span class="mi" style="box-sizing: border-box; color: #009999;">4</span><span class="p" style="box-sizing: border-box;">,</span><span class="mi" style="box-sizing: border-box; color: #009999;">5</span><span class="p" style="box-sizing: border-box;">)</span>
<span class="nb" style="box-sizing: border-box; color: #0086b3;">print</span> <span class="s2" style="box-sizing: border-box; color: #dd1144;">"Sum of 4 and 5 = "</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">+</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">str</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box; color: #333333;">res_int</span><span class="p" style="box-sizing: border-box;">)</span>

<span class="c1" style="box-sizing: border-box; color: #999988; font-style: italic;">#Find sum of floats</span>
<span class="n" style="box-sizing: border-box; color: #333333;">a</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box; color: #333333;">c_float</span><span class="p" style="box-sizing: border-box;">(</span><span class="mf" style="box-sizing: border-box; color: #009999;">5.5</span><span class="p" style="box-sizing: border-box;">)</span>
<span class="n" style="box-sizing: border-box; color: #333333;">b</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box; color: #333333;">c_float</span><span class="p" style="box-sizing: border-box;">(</span><span class="mf" style="box-sizing: border-box; color: #009999;">4.1</span><span class="p" style="box-sizing: border-box;">)</span>

<span class="n" style="box-sizing: border-box; color: #333333;">add_float</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box; color: #333333;">adder</span><span class="o" style="box-sizing: border-box; font-weight: bold;">.</span><span class="n" style="box-sizing: border-box; color: #333333;">add_float</span>
<span class="n" style="box-sizing: border-box; color: #333333;">add_float</span><span class="o" style="box-sizing: border-box; font-weight: bold;">.</span><span class="n" style="box-sizing: border-box; color: #333333;">restype</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="n" style="box-sizing: border-box; color: #333333;">c_float</span>
<span class="nb" style="box-sizing: border-box; color: #0086b3;">print</span> <span class="s2" style="box-sizing: border-box; color: #dd1144;">"Sum of 5.5 and 4.1 = "</span><span class="p" style="box-sizing: border-box;">,</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">str</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box; color: #333333;">add_float</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box; color: #333333;">a</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box; color: #333333;">b</span><span class="p" style="box-sizing: border-box;">))</span>
</pre>
</div>
</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
And the output is as follows</div>
<div class="highlight-default" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; margin: 1px 0px 24px; overflow-x: auto; padding: 0px;">
<div class="highlight" style="background: none; border: none; box-sizing: border-box; margin: 0px; overflow-x: auto; padding: 0px;">
<pre style="box-sizing: border-box; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; line-height: normal; overflow: auto; padding: 12px;"><span style="box-sizing: border-box;"></span><span class="n" style="box-sizing: border-box; color: #333333;">Sum</span> <span class="n" style="box-sizing: border-box; color: #333333;">of</span> <span class="mi" style="box-sizing: border-box; color: #009999;">4</span> <span class="ow" style="box-sizing: border-box; font-weight: bold;">and</span> <span class="mi" style="box-sizing: border-box; color: #009999;">5</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="mi" style="box-sizing: border-box; color: #009999;">9</span>
<span class="n" style="box-sizing: border-box; color: #333333;">Sum</span> <span class="n" style="box-sizing: border-box; color: #333333;">of</span> <span class="mf" style="box-sizing: border-box; color: #009999;">5.5</span> <span class="ow" style="box-sizing: border-box; font-weight: bold;">and</span> <span class="mf" style="box-sizing: border-box; color: #009999;">4.1</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span>  <span class="mf" style="box-sizing: border-box; color: #009999;">9.60000038147</span>
</pre>
</div>
</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
In this example the C file is self explanatory - it contains two functions, one to add two integers and another to add two floats.</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
In the python file, first the ctypes module is imported. Then the CDLL function of the ctypes module is used to load the shared lib file we created. The functions defined in the C lib are now available to us via the&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">adder</span></code>&nbsp;variable. When&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">adder.add_int()</span></code>&nbsp;is called, internally a call is made to the&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">add_int</span></code>&nbsp;C function. The ctypes interface allows us to use native python integers and strings by default while calling the C functions.</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
For other types such as boolean or float, we have to use the correct ctypes. This is seen while passing parameters to the&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">adder.add_float()</span></code>. We first create the required c_float types from python decimal values, and then use them as arguments to the C code. This method is simple and clean, but limited. For example it’s not possible to manipulate objects on the C side.</div>
</div>
<div class="section" id="swig" style="background-color: #fcfcfc; box-sizing: border-box; color: #404040; font-family: Lato, proxima-nova, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-size: 16px;">
<h2 style="box-sizing: border-box; font-family: &quot;Roboto Slab&quot;, ff-tisa-web-pro, Georgia, Arial, sans-serif; font-size: 24px; margin-top: 0px;">
20.2. SWIG</h2>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
Simplified Wrapper and Interface Generator, or SWIG for short is another way to interface C code to Python. In this method, the developer must develop an extra interface file which is an input to SWIG (the command line utility).</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
Python developers generally don’t use this method, because it is in most cases unnecessarily complex. This is a great method when you have a C/C++ code base, and you want to interface it to many different languages.</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
<strong style="box-sizing: border-box;">Example</strong>&nbsp;(from the&nbsp;<a class="reference external" href="http://www.swig.org/tutorial.html" style="box-sizing: border-box; color: #9b59b6; text-decoration-line: none;">SWIG website</a>&nbsp;)</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
The C code,&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">example.c</span></code>&nbsp;that has a variety of functions and variables</div>
<div class="code c highlight-default" style="box-sizing: border-box; color: #999988; font-style: italic;">
<div class="highlight" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; margin: 1px 0px 24px; overflow-x: auto; padding: 0px;">
<pre style="box-sizing: border-box; color: #404040; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; line-height: normal; overflow: auto; padding: 12px;"><span style="box-sizing: border-box;"></span><span class="c1" style="box-sizing: border-box; color: #999988;">#include &lt;time.h&gt;</span>
<span class="n" style="box-sizing: border-box; color: #333333;">double</span> <span class="n" style="box-sizing: border-box; color: #333333;">My_variable</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="mf" style="box-sizing: border-box; color: #009999;">3.0</span><span class="p" style="box-sizing: border-box;">;</span>

<span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">fact</span><span class="p" style="box-sizing: border-box;">(</span><span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">n</span><span class="p" style="box-sizing: border-box;">)</span> <span class="p" style="box-sizing: border-box;">{</span>
    <span class="k" style="box-sizing: border-box; font-weight: bold;">if</span> <span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box; color: #333333;">n</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&lt;=</span> <span class="mi" style="box-sizing: border-box; color: #009999;">1</span><span class="p" style="box-sizing: border-box;">)</span> <span class="k" style="box-sizing: border-box; font-weight: bold;">return</span> <span class="mi" style="box-sizing: border-box; color: #009999;">1</span><span class="p" style="box-sizing: border-box;">;</span>
    <span class="k" style="box-sizing: border-box; font-weight: bold;">else</span> <span class="k" style="box-sizing: border-box; font-weight: bold;">return</span> <span class="n" style="box-sizing: border-box; color: #333333;">n</span><span class="o" style="box-sizing: border-box; font-weight: bold;">*</span><span class="n" style="box-sizing: border-box; color: #333333;">fact</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box; color: #333333;">n</span><span class="o" style="box-sizing: border-box; font-weight: bold;">-</span><span class="mi" style="box-sizing: border-box; color: #009999;">1</span><span class="p" style="box-sizing: border-box;">);</span>
<span class="p" style="box-sizing: border-box;">}</span>

<span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">my_mod</span><span class="p" style="box-sizing: border-box;">(</span><span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">x</span><span class="p" style="box-sizing: border-box;">,</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">y</span><span class="p" style="box-sizing: border-box;">)</span> <span class="p" style="box-sizing: border-box;">{</span>
    <span class="k" style="box-sizing: border-box; font-weight: bold;">return</span> <span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box; color: #333333;">x</span><span class="o" style="box-sizing: border-box; font-weight: bold;">%</span><span class="n" style="box-sizing: border-box; color: #333333;">y</span><span class="p" style="box-sizing: border-box;">);</span>
<span class="p" style="box-sizing: border-box;">}</span>

<span class="n" style="box-sizing: border-box; color: #333333;">char</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">*</span><span class="n" style="box-sizing: border-box; color: #333333;">get_time</span><span class="p" style="box-sizing: border-box;">()</span>
<span class="p" style="box-sizing: border-box;">{</span>
    <span class="n" style="box-sizing: border-box; color: #333333;">time_t</span> <span class="n" style="box-sizing: border-box; color: #333333;">ltime</span><span class="p" style="box-sizing: border-box;">;</span>
    <span class="n" style="box-sizing: border-box; color: #333333;">time</span><span class="p" style="box-sizing: border-box;">(</span><span class="o" style="box-sizing: border-box; font-weight: bold;">&amp;</span><span class="n" style="box-sizing: border-box; color: #333333;">ltime</span><span class="p" style="box-sizing: border-box;">);</span>
    <span class="k" style="box-sizing: border-box; font-weight: bold;">return</span> <span class="n" style="box-sizing: border-box; color: #333333;">ctime</span><span class="p" style="box-sizing: border-box;">(</span><span class="o" style="box-sizing: border-box; font-weight: bold;">&amp;</span><span class="n" style="box-sizing: border-box; color: #333333;">ltime</span><span class="p" style="box-sizing: border-box;">);</span>
<span class="p" style="box-sizing: border-box;">}</span>
</pre>
</div>
</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
The interface file - this will remain the same irrespective of the language you want to port your C code to :</div>
<div class="highlight-default" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; margin: 1px 0px 24px; overflow-x: auto; padding: 0px;">
<div class="highlight" style="background: none; border: none; box-sizing: border-box; margin: 0px; overflow-x: auto; padding: 0px;">
<pre style="box-sizing: border-box; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; line-height: normal; overflow: auto; padding: 12px;"><span style="box-sizing: border-box;"></span><span class="o" style="box-sizing: border-box; font-weight: bold;">/*</span> <span class="n" style="box-sizing: border-box; color: #333333;">example</span><span class="o" style="box-sizing: border-box; font-weight: bold;">.</span><span class="n" style="box-sizing: border-box; color: #333333;">i</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">*/</span>
 <span class="o" style="box-sizing: border-box; font-weight: bold;">%</span><span class="n" style="box-sizing: border-box; color: #333333;">module</span> <span class="n" style="box-sizing: border-box; color: #333333;">example</span>
 <span class="o" style="box-sizing: border-box; font-weight: bold;">%</span><span class="p" style="box-sizing: border-box;">{</span>
 <span class="o" style="box-sizing: border-box; font-weight: bold;">/*</span> <span class="n" style="box-sizing: border-box; color: #333333;">Put</span> <span class="n" style="box-sizing: border-box; color: #333333;">header</span> <span class="n" style="box-sizing: border-box; color: #333333;">files</span> <span class="n" style="box-sizing: border-box; color: #333333;">here</span> <span class="ow" style="box-sizing: border-box; font-weight: bold;">or</span> <span class="n" style="box-sizing: border-box; color: #333333;">function</span> <span class="n" style="box-sizing: border-box; color: #333333;">declarations</span> <span class="n" style="box-sizing: border-box; color: #333333;">like</span> <span class="n" style="box-sizing: border-box; color: #333333;">below</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">*/</span>
 <span class="n" style="box-sizing: border-box; color: #333333;">extern</span> <span class="n" style="box-sizing: border-box; color: #333333;">double</span> <span class="n" style="box-sizing: border-box; color: #333333;">My_variable</span><span class="p" style="box-sizing: border-box;">;</span>
 <span class="n" style="box-sizing: border-box; color: #333333;">extern</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">fact</span><span class="p" style="box-sizing: border-box;">(</span><span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">n</span><span class="p" style="box-sizing: border-box;">);</span>
 <span class="n" style="box-sizing: border-box; color: #333333;">extern</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">my_mod</span><span class="p" style="box-sizing: border-box;">(</span><span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">x</span><span class="p" style="box-sizing: border-box;">,</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">y</span><span class="p" style="box-sizing: border-box;">);</span>
 <span class="n" style="box-sizing: border-box; color: #333333;">extern</span> <span class="n" style="box-sizing: border-box; color: #333333;">char</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">*</span><span class="n" style="box-sizing: border-box; color: #333333;">get_time</span><span class="p" style="box-sizing: border-box;">();</span>
 <span class="o" style="box-sizing: border-box; font-weight: bold;">%</span><span class="p" style="box-sizing: border-box;">}</span>

 <span class="n" style="box-sizing: border-box; color: #333333;">extern</span> <span class="n" style="box-sizing: border-box; color: #333333;">double</span> <span class="n" style="box-sizing: border-box; color: #333333;">My_variable</span><span class="p" style="box-sizing: border-box;">;</span>
 <span class="n" style="box-sizing: border-box; color: #333333;">extern</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">fact</span><span class="p" style="box-sizing: border-box;">(</span><span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">n</span><span class="p" style="box-sizing: border-box;">);</span>
 <span class="n" style="box-sizing: border-box; color: #333333;">extern</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">my_mod</span><span class="p" style="box-sizing: border-box;">(</span><span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">x</span><span class="p" style="box-sizing: border-box;">,</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">y</span><span class="p" style="box-sizing: border-box;">);</span>
 <span class="n" style="box-sizing: border-box; color: #333333;">extern</span> <span class="n" style="box-sizing: border-box; color: #333333;">char</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">*</span><span class="n" style="box-sizing: border-box; color: #333333;">get_time</span><span class="p" style="box-sizing: border-box;">();</span>
</pre>
</div>
</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
And now to compile it</div>
<div class="highlight-default" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; margin: 1px 0px 24px; overflow-x: auto; padding: 0px;">
<div class="highlight" style="background: none; border: none; box-sizing: border-box; margin: 0px; overflow-x: auto; padding: 0px;">
<pre style="box-sizing: border-box; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; line-height: normal; overflow: auto; padding: 12px;"><span style="box-sizing: border-box;"></span><span class="n" style="box-sizing: border-box; color: #333333;">unix</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">%</span> <span class="n" style="box-sizing: border-box; color: #333333;">swig</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">-</span><span class="n" style="box-sizing: border-box; color: #333333;">python</span> <span class="n" style="box-sizing: border-box; color: #333333;">example</span><span class="o" style="box-sizing: border-box; font-weight: bold;">.</span><span class="n" style="box-sizing: border-box; color: #333333;">i</span>
<span class="n" style="box-sizing: border-box; color: #333333;">unix</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">%</span> <span class="n" style="box-sizing: border-box; color: #333333;">gcc</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">-</span><span class="n" style="box-sizing: border-box; color: #333333;">c</span> <span class="n" style="box-sizing: border-box; color: #333333;">example</span><span class="o" style="box-sizing: border-box; font-weight: bold;">.</span><span class="n" style="box-sizing: border-box; color: #333333;">c</span> <span class="n" style="box-sizing: border-box; color: #333333;">example_wrap</span><span class="o" style="box-sizing: border-box; font-weight: bold;">.</span><span class="n" style="box-sizing: border-box; color: #333333;">c</span> \
        <span class="o" style="box-sizing: border-box; font-weight: bold;">-</span><span class="n" style="box-sizing: border-box; color: #333333;">I</span><span class="o" style="box-sizing: border-box; font-weight: bold;">/</span><span class="n" style="box-sizing: border-box; color: #333333;">usr</span><span class="o" style="box-sizing: border-box; font-weight: bold;">/</span><span class="n" style="box-sizing: border-box; color: #333333;">local</span><span class="o" style="box-sizing: border-box; font-weight: bold;">/</span><span class="n" style="box-sizing: border-box; color: #333333;">include</span><span class="o" style="box-sizing: border-box; font-weight: bold;">/</span><span class="n" style="box-sizing: border-box; color: #333333;">python2</span><span class="o" style="box-sizing: border-box; font-weight: bold;">.</span><span class="mi" style="box-sizing: border-box; color: #009999;">1</span>
<span class="n" style="box-sizing: border-box; color: #333333;">unix</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">%</span> <span class="n" style="box-sizing: border-box; color: #333333;">ld</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">-</span><span class="n" style="box-sizing: border-box; color: #333333;">shared</span> <span class="n" style="box-sizing: border-box; color: #333333;">example</span><span class="o" style="box-sizing: border-box; font-weight: bold;">.</span><span class="n" style="box-sizing: border-box; color: #333333;">o</span> <span class="n" style="box-sizing: border-box; color: #333333;">example_wrap</span><span class="o" style="box-sizing: border-box; font-weight: bold;">.</span><span class="n" style="box-sizing: border-box; color: #333333;">o</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">-</span><span class="n" style="box-sizing: border-box; color: #333333;">o</span> <span class="n" style="box-sizing: border-box; color: #333333;">_example</span><span class="o" style="box-sizing: border-box; font-weight: bold;">.</span><span class="n" style="box-sizing: border-box; color: #333333;">so</span>
</pre>
</div>
</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
Finally, the Python output</div>
<div class="code python highlight-default" style="box-sizing: border-box;">
<div class="highlight" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; margin: 1px 0px 24px; overflow-x: auto; padding: 0px;">
<pre style="box-sizing: border-box; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; line-height: normal; overflow: auto; padding: 12px;"><span style="box-sizing: border-box;"></span><span class="gp" style="box-sizing: border-box; color: #555555;">&gt;&gt;&gt; </span><span class="kn" style="box-sizing: border-box; font-weight: bold;">import</span> <span class="nn" style="box-sizing: border-box; color: #555555;">example</span>
<span class="gp" style="box-sizing: border-box; color: #555555;">&gt;&gt;&gt; </span><span class="n" style="box-sizing: border-box; color: #333333;">example</span><span class="o" style="box-sizing: border-box; font-weight: bold;">.</span><span class="n" style="box-sizing: border-box; color: #333333;">fact</span><span class="p" style="box-sizing: border-box;">(</span><span class="mi" style="box-sizing: border-box; color: #009999;">5</span><span class="p" style="box-sizing: border-box;">)</span>
<span class="go" style="box-sizing: border-box; color: #888888;">120</span>
<span class="gp" style="box-sizing: border-box; color: #555555;">&gt;&gt;&gt; </span><span class="n" style="box-sizing: border-box; color: #333333;">example</span><span class="o" style="box-sizing: border-box; font-weight: bold;">.</span><span class="n" style="box-sizing: border-box; color: #333333;">my_mod</span><span class="p" style="box-sizing: border-box;">(</span><span class="mi" style="box-sizing: border-box; color: #009999;">7</span><span class="p" style="box-sizing: border-box;">,</span><span class="mi" style="box-sizing: border-box; color: #009999;">3</span><span class="p" style="box-sizing: border-box;">)</span>
<span class="go" style="box-sizing: border-box; color: #888888;">1</span>
<span class="gp" style="box-sizing: border-box; color: #555555;">&gt;&gt;&gt; </span><span class="n" style="box-sizing: border-box; color: #333333;">example</span><span class="o" style="box-sizing: border-box; font-weight: bold;">.</span><span class="n" style="box-sizing: border-box; color: #333333;">get_time</span><span class="p" style="box-sizing: border-box;">()</span>
<span class="go" style="box-sizing: border-box; color: #888888;">'Sun Feb 11 23:01:07 1996'</span>
<span class="go" style="box-sizing: border-box; color: #888888;">&gt;&gt;&gt;</span>
</pre>
</div>
</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
As we can see, SWIG achieves the same result, but requires a slightly more involved effort. But it’s worth it if you are targeting multiple languages.</div>
</div>
<div class="section" id="python-c-api" style="background-color: #fcfcfc; box-sizing: border-box; color: #404040; font-family: Lato, proxima-nova, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-size: 16px;">
<h2 style="box-sizing: border-box; font-family: &quot;Roboto Slab&quot;, ff-tisa-web-pro, Georgia, Arial, sans-serif; font-size: 24px; margin-top: 0px;">
20.3. Python/C API</h2>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
The&nbsp;<a class="reference external" href="https://docs.python.org/2/c-api/" style="box-sizing: border-box; color: #9b59b6; text-decoration-line: none;">C/Python API</a>&nbsp;is probably the most widely used method - not for it’s simplicity but for the fact that you can manipulate python objects in your C code.</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
This method requires your C code to be specifically written for interfacing with Python code. All Python objects are represented as a PyObject struct and the&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">Python.h</span></code>&nbsp;header file provides various functions to manipulate it. For example if the PyObject is also a PyListType (basically a list), then we can use the&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">PyList_Size()</span></code>&nbsp;function on the struct to get the length of the list. This is equivalent to calling&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">len(list)</span></code>&nbsp;in python. Most of the basic functions/opertions that are there for native Python objects are made available in C via the&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">Python.h</span></code>&nbsp;header.</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
<strong style="box-sizing: border-box;">Example</strong></div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
To write a C extension that adds all the elements in a python list. (all elements are numbers)</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
Let’s start with the final interface we’d like to have, here is the python file that uses the C extension :</div>
<div class="code python highlight-default" style="box-sizing: border-box;">
<div class="highlight" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; margin: 1px 0px 24px; overflow-x: auto; padding: 0px;">
<pre style="box-sizing: border-box; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; line-height: normal; overflow: auto; padding: 12px;"><span style="box-sizing: border-box;"></span><span class="c1" style="box-sizing: border-box; color: #999988; font-style: italic;">#Though it looks like an ordinary python import, the addList module is implemented in C</span>
<span class="kn" style="box-sizing: border-box; font-weight: bold;">import</span> <span class="nn" style="box-sizing: border-box; color: #555555;">addList</span>

<span class="n" style="box-sizing: border-box; color: #333333;">l</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="p" style="box-sizing: border-box;">[</span><span class="mi" style="box-sizing: border-box; color: #009999;">1</span><span class="p" style="box-sizing: border-box;">,</span><span class="mi" style="box-sizing: border-box; color: #009999;">2</span><span class="p" style="box-sizing: border-box;">,</span><span class="mi" style="box-sizing: border-box; color: #009999;">3</span><span class="p" style="box-sizing: border-box;">,</span><span class="mi" style="box-sizing: border-box; color: #009999;">4</span><span class="p" style="box-sizing: border-box;">,</span><span class="mi" style="box-sizing: border-box; color: #009999;">5</span><span class="p" style="box-sizing: border-box;">]</span>
<span class="nb" style="box-sizing: border-box; color: #0086b3;">print</span> <span class="s2" style="box-sizing: border-box; color: #dd1144;">"Sum of List - "</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">+</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">str</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box; color: #333333;">l</span><span class="p" style="box-sizing: border-box;">)</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">+</span> <span class="s2" style="box-sizing: border-box; color: #dd1144;">" = "</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">+</span>  <span class="nb" style="box-sizing: border-box; color: #0086b3;">str</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box; color: #333333;">addList</span><span class="o" style="box-sizing: border-box; font-weight: bold;">.</span><span class="n" style="box-sizing: border-box; color: #333333;">add</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box; color: #333333;">l</span><span class="p" style="box-sizing: border-box;">))</span>
</pre>
</div>
</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
The above looks like any ordinary python file, which imports and uses another python module called&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">addList</span></code>. The only difference is that the addList module is not written in Python at all, but rather in C.</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
Next we’ll have a look at the C code that get’s built into the&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">addList</span></code>&nbsp;Python module. This may seem a bit daunting at first, but once you understand the various components that go into writing the C file, it’s pretty straight forward.</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
<em style="box-sizing: border-box;">adder.c</em></div>
<div class="code c highlight-default" style="box-sizing: border-box; color: #999988; font-style: italic;">
<div class="highlight" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; margin: 1px 0px 24px; overflow-x: auto; padding: 0px;">
<pre style="box-sizing: border-box; color: #404040; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; line-height: normal; overflow: auto; padding: 12px;"><span style="box-sizing: border-box;"></span>//Python.h has all the required function definitions to manipulate the Python objects
#include &lt;Python.h&gt;

 //This is the function that is called from your python code
static PyObject* addList_add(PyObject* self, PyObject* args){

  PyObject * listObj;

  //The input arguments come as a tuple, we parse the args to get the various variables
  //In this case it's only one list variable, which will now be referenced by listObj
  if (! PyArg_ParseTuple( args, "O", &amp;listObj))
    return NULL;

  //length of the list
  long length = PyList_Size(listObj);

  //iterate over all the elements
  int i, sum =0;
  for(i = 0; i &lt; length; i++){
    //get an element out of the list - the element is also a python objects
    PyObject* temp = PyList_GetItem(listObj, i);
    //we know that object represents an integer - so convert it into C long
    long elem = PyInt_AsLong(temp);
    sum += elem;
  }

  //value returned back to python code - another python object
  //build value here converts the C long to a python integer
  return Py_BuildValue("i", sum);
}

//This is the docstring that corresponds to our 'add' function.
static char addList_docs[] =
    "add( ): add all elements of the list\n";

/* This table contains the relavent info mapping -
  &lt;function-name in python module&gt;, &lt;actual-function&gt;,
  &lt;type-of-args the function expects&gt;, &lt;docstring associated with the function&gt;
*/
static PyMethodDef addList_funcs[] = {
    {"add", (PyCFunction)addList_add, METH_VARARGS, addList_docs},
    {NULL, NULL, 0, NULL}
};

/*
addList is the module name, and this is the initialization block of the module.
&lt;desired module name&gt;, &lt;the-info-table&gt;, &lt;module's-docstring&gt;
*/
PyMODINIT_FUNC initaddList(void){
    Py_InitModule3("addList", addList_funcs,
                   "Add all ze lists");
}
</pre>
</div>
</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
A step by step explanation :</div>
<ul class="simple" style="box-sizing: border-box; line-height: 24px; list-style-image: initial; list-style-position: initial; margin: 0px 0px 24px; padding: 0px;">
<li style="box-sizing: border-box; list-style: disc; margin-left: 24px;">The&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">&lt;Python.h&gt;</span></code>&nbsp;file consists of all the required types (to represent Python object types) and function definitions (to operate on the python objects).</li>
<li style="box-sizing: border-box; list-style: disc; margin-left: 24px;">Next we write the function which we plan to call from python. Conventionally the function names are {module-name}_{function-name}, which in this case is&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">addList_add</span></code>. More about the function later.</li>
<li style="box-sizing: border-box; list-style: disc; margin-left: 24px;">Then fill in the info table - which contains all the relevant info of the functions we desire to have in the module. Every row corresponds to a function, with the last one being a sentinel value (row of null elements).</li>
<li style="box-sizing: border-box; list-style: disc; margin-left: 24px;">Finally the module initialization block which is of the signature&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">PyMODINIT_FUNC</span>&nbsp;<span class="pre" style="box-sizing: border-box;">init{module-name}</span></code>.</li>
</ul>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
The function&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">addList_add</span></code>&nbsp;accepts arguments as a PyObject type struct (args is also a tuple type - but since everything in python is an object, we use the generic PyObject notion). The incoming arguments is parsed (basically split the tuple into individual elements) by&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">PyArg_ParseTuple()</span></code>. The first parameter is the argument variable to be parsed. The second argument is a string that tells us how to parse each element in the args tuple. The character in the Nth position of the string tells us the type of the Nth element in the args tuple, example - ‘i’ would mean integer, ‘s’ would mean string and ‘O’ would mean a Python object. Next multiple arguments follow, these are where you would like the&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">PyArg_ParseTuple()</span></code>&nbsp;function to store all the elements that it has parsed. The number of such arguments is equal to the number of arguments which the module function expects to receive, and positional integrity is maintained. For example if we expected a string, integer and a python list in that order, the function signature would be</div>
<div class="code c highlight-default" style="box-sizing: border-box; color: #999988; font-style: italic;">
<div class="highlight" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; margin: 1px 0px 24px; overflow-x: auto; padding: 0px;">
<pre style="box-sizing: border-box; color: #404040; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; line-height: normal; overflow: auto; padding: 12px;"><span style="box-sizing: border-box;"></span><span class="nb" style="box-sizing: border-box; color: #0086b3;">int</span> <span class="n" style="box-sizing: border-box; color: #333333;">n</span><span class="p" style="box-sizing: border-box;">;</span>
<span class="n" style="box-sizing: border-box; color: #333333;">char</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">*</span><span class="n" style="box-sizing: border-box; color: #333333;">s</span><span class="p" style="box-sizing: border-box;">;</span>
<span class="n" style="box-sizing: border-box; color: #333333;">PyObject</span><span class="o" style="box-sizing: border-box; font-weight: bold;">*</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">list</span><span class="p" style="box-sizing: border-box;">;</span>
<span class="n" style="box-sizing: border-box; color: #333333;">PyArg_ParseTuple</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box; color: #333333;">args</span><span class="p" style="box-sizing: border-box;">,</span> <span class="s2" style="box-sizing: border-box; color: #dd1144;">"siO"</span><span class="p" style="box-sizing: border-box;">,</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&amp;</span><span class="n" style="box-sizing: border-box; color: #333333;">n</span><span class="p" style="box-sizing: border-box;">,</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&amp;</span><span class="n" style="box-sizing: border-box; color: #333333;">s</span><span class="p" style="box-sizing: border-box;">,</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">&amp;</span><span class="nb" style="box-sizing: border-box; color: #0086b3;">list</span><span class="p" style="box-sizing: border-box;">);</span>
</pre>
</div>
</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
In this case we only have to extract a list object, and store it in the variable&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">listObj</span></code>. We then use the&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">PyList_Size()</span></code>&nbsp;function on our list object and get the length. This is similar to how you would call&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">len(list)</span></code>&nbsp;in python.</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
Now we loop through the list, get each element using the&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">PyList_GetItem(list,</span>&nbsp;<span class="pre" style="box-sizing: border-box;">index)</span></code>&nbsp;function. This returns a PyObject*. But since we know that the Python objects are also&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">PyIntType</span></code>, we just use the&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">PyInt_AsLong(PyObj</span>&nbsp;<span class="pre" style="box-sizing: border-box;">*)</span></code>&nbsp;function to get the required value. We do this for every element and finally get the sum.</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
The sum is converted to a python object and is returned to the Python code with the help of&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">Py_BuildValue()</span></code>. Here the “i” indicates that the value we want to build is a python integer object.</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
Now we build the C module. Save the following code as&nbsp;<code class="docutils literal" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; color: #e74c3c; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; max-width: 100%; overflow-x: auto; padding: 2px 5px; white-space: nowrap;"><span class="pre" style="box-sizing: border-box;">setup.py</span></code></div>
<div class="code python highlight-default" style="box-sizing: border-box;">
<div class="highlight" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; margin: 1px 0px 24px; overflow-x: auto; padding: 0px;">
<pre style="box-sizing: border-box; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; line-height: normal; overflow: auto; padding: 12px;"><span style="box-sizing: border-box;"></span><span class="c1" style="box-sizing: border-box; color: #999988; font-style: italic;">#build the modules</span>

<span class="kn" style="box-sizing: border-box; font-weight: bold;">from</span> <span class="nn" style="box-sizing: border-box; color: #555555;">distutils.core</span> <span class="k" style="box-sizing: border-box; font-weight: bold;">import</span> <span class="n" style="box-sizing: border-box; color: #333333;">setup</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box; color: #333333;">Extension</span>

<span class="n" style="box-sizing: border-box; color: #333333;">setup</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box; color: #333333;">name</span><span class="o" style="box-sizing: border-box; font-weight: bold;">=</span><span class="s1" style="box-sizing: border-box; color: #dd1144;">'addList'</span><span class="p" style="box-sizing: border-box;">,</span> <span class="n" style="box-sizing: border-box; color: #333333;">version</span><span class="o" style="box-sizing: border-box; font-weight: bold;">=</span><span class="s1" style="box-sizing: border-box; color: #dd1144;">'1.0'</span><span class="p" style="box-sizing: border-box;">,</span>  \
      <span class="n" style="box-sizing: border-box; color: #333333;">ext_modules</span><span class="o" style="box-sizing: border-box; font-weight: bold;">=</span><span class="p" style="box-sizing: border-box;">[</span><span class="n" style="box-sizing: border-box; color: #333333;">Extension</span><span class="p" style="box-sizing: border-box;">(</span><span class="s1" style="box-sizing: border-box; color: #dd1144;">'addList'</span><span class="p" style="box-sizing: border-box;">,</span> <span class="p" style="box-sizing: border-box;">[</span><span class="s1" style="box-sizing: border-box; color: #dd1144;">'adder.c'</span><span class="p" style="box-sizing: border-box;">])])</span>
</pre>
</div>
</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
and run</div>
<div class="code sh highlight-default" style="box-sizing: border-box; color: #dd1144;">
<div class="highlight" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; margin: 1px 0px 24px; overflow-x: auto; padding: 0px;">
<pre style="box-sizing: border-box; color: #404040; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; line-height: normal; overflow: auto; padding: 12px;"><span style="box-sizing: border-box;"></span><span class="n" style="box-sizing: border-box; color: #333333;">python</span> <span class="n" style="box-sizing: border-box; color: #333333;">setup</span><span class="o" style="box-sizing: border-box; font-weight: bold;">.</span><span class="n" style="box-sizing: border-box; color: #333333;">py</span> <span class="n" style="box-sizing: border-box; color: #333333;">install</span>
</pre>
</div>
</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
This should now build and install the C file into the python module we desire.</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
After all this hard work, we’ll now test if the module works -</div>
<div class="code python highlight-default" style="box-sizing: border-box;">
<div class="highlight" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; margin: 1px 0px 24px; overflow-x: auto; padding: 0px;">
<pre style="box-sizing: border-box; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; line-height: normal; overflow: auto; padding: 12px;"><span style="box-sizing: border-box;"></span><span class="c1" style="box-sizing: border-box; color: #999988; font-style: italic;">#module that talks to the C code</span>
<span class="kn" style="box-sizing: border-box; font-weight: bold;">import</span> <span class="nn" style="box-sizing: border-box; color: #555555;">addList</span>

<span class="n" style="box-sizing: border-box; color: #333333;">l</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="p" style="box-sizing: border-box;">[</span><span class="mi" style="box-sizing: border-box; color: #009999;">1</span><span class="p" style="box-sizing: border-box;">,</span><span class="mi" style="box-sizing: border-box; color: #009999;">2</span><span class="p" style="box-sizing: border-box;">,</span><span class="mi" style="box-sizing: border-box; color: #009999;">3</span><span class="p" style="box-sizing: border-box;">,</span><span class="mi" style="box-sizing: border-box; color: #009999;">4</span><span class="p" style="box-sizing: border-box;">,</span><span class="mi" style="box-sizing: border-box; color: #009999;">5</span><span class="p" style="box-sizing: border-box;">]</span>
<span class="nb" style="box-sizing: border-box; color: #0086b3;">print</span> <span class="s2" style="box-sizing: border-box; color: #dd1144;">"Sum of List - "</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">+</span> <span class="nb" style="box-sizing: border-box; color: #0086b3;">str</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box; color: #333333;">l</span><span class="p" style="box-sizing: border-box;">)</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">+</span> <span class="s2" style="box-sizing: border-box; color: #dd1144;">" = "</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">+</span>  <span class="nb" style="box-sizing: border-box; color: #0086b3;">str</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box; color: #333333;">addList</span><span class="o" style="box-sizing: border-box; font-weight: bold;">.</span><span class="n" style="box-sizing: border-box; color: #333333;">add</span><span class="p" style="box-sizing: border-box;">(</span><span class="n" style="box-sizing: border-box; color: #333333;">l</span><span class="p" style="box-sizing: border-box;">))</span>
</pre>
</div>
</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
And here is the output</div>
<div class="highlight-default" style="background: rgb(255, 255, 255); border: 1px solid rgb(225, 228, 229); box-sizing: border-box; margin: 1px 0px 24px; overflow-x: auto; padding: 0px;">
<div class="highlight" style="background: none; border: none; box-sizing: border-box; margin: 0px; overflow-x: auto; padding: 0px;">
<pre style="box-sizing: border-box; font-family: Consolas, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, Monaco, &quot;Courier New&quot;, Courier, monospace; font-size: 12px; line-height: normal; overflow: auto; padding: 12px;"><span style="box-sizing: border-box;"></span><span class="n" style="box-sizing: border-box; color: #333333;">Sum</span> <span class="n" style="box-sizing: border-box; color: #333333;">of</span> <span class="n" style="box-sizing: border-box; color: #333333;">List</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">-</span> <span class="p" style="box-sizing: border-box;">[</span><span class="mi" style="box-sizing: border-box; color: #009999;">1</span><span class="p" style="box-sizing: border-box;">,</span> <span class="mi" style="box-sizing: border-box; color: #009999;">2</span><span class="p" style="box-sizing: border-box;">,</span> <span class="mi" style="box-sizing: border-box; color: #009999;">3</span><span class="p" style="box-sizing: border-box;">,</span> <span class="mi" style="box-sizing: border-box; color: #009999;">4</span><span class="p" style="box-sizing: border-box;">,</span> <span class="mi" style="box-sizing: border-box; color: #009999;">5</span><span class="p" style="box-sizing: border-box;">]</span> <span class="o" style="box-sizing: border-box; font-weight: bold;">=</span> <span class="mi" style="box-sizing: border-box; color: #009999;">15</span>
</pre>
</div>
</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
So as you can see, we have developed our first successful C Python extension using the Python.h API. This method does seem complex at first, but once you get used to it it can prove to be quite useful.</div>
<div style="box-sizing: border-box; line-height: 24px; margin-bottom: 24px;">
Other ways to interface C code to Python is to use an alternative and faster build of python -&nbsp;<a class="reference external" href="http://cython.org/" style="box-sizing: border-box; color: #9b59b6; text-decoration-line: none;">Cython</a>. But Cython is a slightly different language than the main stream python we see. Hence that method is not covered here.</div>
</div>
